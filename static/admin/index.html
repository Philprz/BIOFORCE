<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bioforce Admin</title>
    <style>
        :root {
            --primary-color: #e74324;
            --primary-dark: #FF5733;
            --secondary-color: #2c3e50;
            --background-color: #f4f6f9;
            --card-color: #ffffff;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --text-color: #333333;
            --text-light: #666666;
            --border-color: #e0e0e0;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Open Sans', Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
        }
        
        .header-actions {
            display: flex;
        }
        
        .header-actions button {
            background: none;
            border: 1px solid white;
            color: white;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            margin-left: 0.5rem;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        .header-actions button:hover {
            background-color: rgba(255,255,255,0.1);
        }
        
        main {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 3fr;
            gap: 1.5rem;
        }
        
        .navigation {
            background-color: var(--card-color);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            padding: 1.5rem;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 0.5rem;
            margin-bottom: 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
            color: var(--text-color);
            text-decoration: none;
        }
        
        .nav-item.active, .nav-item:hover {
            background-color: rgba(239, 125, 0, 0.1);
            color: var(--primary-color);
        }
        
        .nav-item svg {
            margin-right: 0.5rem;
        }
        
        .section-header {
            font-size: 1.2rem;
            color: var(--text-light);
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .section-header:first-child {
            margin-top: 0;
        }
        
        .system-info {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-top: 2rem;
        }
        
        .system-info p {
            margin-bottom: 0.3rem;
        }
        
        .dashboard-content {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .card {
            background-color: var(--card-color);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            padding: 1.5rem;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            color: var(--primary-color);
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .card-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .status-item {
            display: flex;
            align-items: center;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        
        .status-indicator.ok {
            background-color: var(--success-color);
        }
        
        .status-indicator.error {
            background-color: var(--danger-color);
        }
        
        .status-indicator.warning {
            background-color: var(--warning-color);
        }
        
        .status-text {
            font-size: 0.9rem;
        }
        
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .action-button {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.75rem;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        .action-button:hover {
            background-color: var(--primary-dark);
        }
        
        .action-button svg {
            margin-right: 0.5rem;
        }
        
        .action-button.secondary {
            background-color: var(--secondary-color);
        }
        
        .scraping-options {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .scraping-options input[type="checkbox"] {
            margin-right: 0.5rem;
        }
        
        .logs-container {
            background-color: #1e1e1e;
            color: #f8f8f8;
            border-radius: 4px;
            padding: 1rem;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .collection-stats {
            background-color: #f9f9f9;
            border-radius: 4px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .collection-stats.error {
            background-color: #ffebee;
            color: var(--danger-color);
        }
        
        .stats-label {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .stats-value {
            font-family: monospace;
        }
        
        .refresh-button {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
            margin-top: 1rem;
        }
        
        .refresh-button:hover {
            background-color: #1a2733;
        }
        
        .refresh-button svg {
            margin-right: 0.5rem;
        }
        
        .github-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .repo-info {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .repo-info svg {
            margin-right: 0.5rem;
            fill: var(--secondary-color);
        }
        
        .update-button {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.75rem;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
            margin-top: 0.5rem;
        }
        
        .update-button:hover {
            background-color: #1a2733;
        }
        
        .system-logs {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
    </style>
</head>
<body>
    <header>
        <h1>Bioforce Admin</h1>
        <div class="header-actions">
            <button id="refresh-status">Actualiser</button>
        </div>
    </header>
    
    <main>
        <div class="dashboard-grid">
            <div class="navigation">
                <a href="#dashboard" class="nav-item active">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="7" height="9"></rect>
                        <rect x="14" y="3" width="7" height="5"></rect>
                        <rect x="14" y="12" width="7" height="9"></rect>
                        <rect x="3" y="16" width="7" height="5"></rect>
                    </svg>
                    Tableau de bord
                </a>
                <a href="#scraping" class="nav-item">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
                        <circle cx="12" cy="10" r="3"></circle>
                    </svg>
                    Scraping
                </a>
                <a href="#qdrant" class="nav-item">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m21.21 15.89-9-9a6 6 0 1 0 8.48 8.48l-7.07-7.07a3 3 0 1 0 4.24 4.24"></path>
                    </svg>
                    Qdrant
                </a>
                <a href="https://github.com/your-username/bioforce-bot" target="_blank" class="nav-item">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6 0 0 0-1.3-3.2 4.2 4.2 0 0 0-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3 0 0 0-6.2 0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2 0 0 0-.1 3.2A4.6 4.6 0 0 0 4 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"></path>
                    </svg>
                    GitHub
                </a>
                <a href="#logs" class="nav-item">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    Logs
                </a>
                
                <div class="section-header">Informations système</div>
                <div class="system-info">
                    <p>Version: <span id="version">1.0.0</span></p>
                    <p>Python: <span id="python-version">3.10.12</span></p>
                    <p>Plateforme: <span id="platform">Render</span></p>
                    <p>Date: <span id="date">2 mai 2025</span></p>
                </div>
            </div>
            
            <div class="dashboard-content">
                <div class="card" id="server-status">
                    <div class="card-header">État du serveur</div>
                    <div class="status-grid">
                        <div class="status-item">
                            <div class="status-indicator error" id="server-indicator"></div>
                            <div class="status-text" id="server-status-text">Erreur de connexion</div>
                        </div>
                        <div class="status-item">
                            <div class="status-indicator error" id="scraping-indicator"></div>
                            <div class="status-text" id="scraping-status-text">Erreur de connexion</div>
                        </div>
                        <div class="status-item">
                            <div class="status-indicator error" id="qdrant-indicator"></div>
                            <div class="status-text" id="qdrant-status-text">Erreur de connexion</div>
                        </div>
                    </div>
                    
                    <div class="card-grid">
                        <div>
                            <div class="stats-label">Statistiques générales</div>
                            <div class="stats-value">Dernière mise à jour: <span id="last-update">02/05/2025 09:33:51</span> <span id="refresh-indicator">(échec)</span></div>
                        </div>
                        <div>
                            <div class="stats-label">Accès rapides</div>
                            <div class="actions-grid">
                                <button class="action-button" id="start-scraping">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
                                        <circle cx="12" cy="10" r="3"></circle>
                                    </svg>
                                    Lancer un scraping
                                </button>
                                <button class="action-button secondary" id="update-from-github">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 2v6h-6"></path>
                                        <path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path>
                                        <path d="M3 22v-6h6"></path>
                                        <path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
                                    </svg>
                                    Mettre à jour depuis GitHub
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <button class="refresh-button" id="verify-services">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 2v6h-6"></path>
                            <path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path>
                            <path d="M3 22v-6h6"></path>
                            <path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
                        </svg>
                        Vérifier l'état des services
                    </button>
                </div>
                
                <div class="card" id="scraping-card">
                    <div class="card-header">Scraping de données</div>
                    
                    <div class="card-grid">
                        <div>
                            <div class="stats-label">Scraping FAQ</div>
                            <div class="stats-value">Lance un scraping des pages FAQ du site Bioforce.</div>
                            <div class="scraping-options">
                                <input type="checkbox" id="force-faq-update" />
                                <label for="force-faq-update">Forcer la mise à jour (ignorer le cache)</label>
                            </div>
                            <button class="action-button" id="launch-faq-scraping">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                                </svg>
                                Lancer le scraping FAQ
                            </button>
                        </div>
                        <div>
                            <div class="stats-label">Scraping site complet</div>
                            <div class="stats-value">Lance un scraping complet du site Bioforce.</div>
                            <div class="scraping-options">
                                <input type="checkbox" id="force-full-update" />
                                <label for="force-full-update">Forcer la mise à jour (ignorer le cache)</label>
                            </div>
                            <button class="action-button" id="launch-full-scraping">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                                </svg>
                                Lancer le scraping complet
                            </button>
                        </div>
                    </div>
                    
                    <div class="section-header">Logs de scraping</div>
                    <div class="logs-container" id="scraping-logs">
                        Aucun log de scraping disponible.
                    </div>
                </div>
                
                <div class="card" id="database-card">
                    <div class="card-header">Base de connaissances Qdrant</div>
                    
                    <div class="stats-label">Statistiques des collections</div>
                    <div class="collection-stats error" id="qdrant-stats">
                        Erreur: Échec de fetch
                    </div>
                    
                    <div class="actions-grid">
                        <button class="action-button" id="verify-connection">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                <polyline points="22 4 12 14.01 9 11.01"></polyline>
                            </svg>
                            Vérifier la connexion
                        </button>
                        <button class="action-button secondary" id="optimize-collections">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 20h9"></path>
                                <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                            </svg>
                            Optimiser les collections
                        </button>
                    </div>
                </div>
                
                <div class="card" id="github-card">
                    <div class="card-header">GitHub</div>
                    
                    <div class="github-container">
                        <div>
                            <div class="repo-info">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6 0 0 0-1.3-3.2 4.2 4.2 0 0 0-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3 0 0 0-6.2 0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2 0 0 0-.1 3.2A4.6 4.6 0 0 0 4 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"></path>
                                </svg>
                                <span id="repo-name">Dépôt : bioforce-bot</span>
                            </div>
                            <div class="repo-info">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                                    <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                                </svg>
                                <span id="last-commit">Dernière mise à jour : </span>
                            </div>
                        </div>
                        
                        <button class="update-button" id="github-update">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 2v6h-6"></path>
                                <path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path>
                                <path d="M3 22v-6h6"></path>
                                <path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
                            </svg>
                            Mettre à jour depuis GitHub
                        </button>
                    </div>
                    
                    <div class="section-header">Logs de mise à jour</div>
                    <div class="logs-container" id="github-logs">
                        Aucun log de mise à jour disponible.
                    </div>
                </div>
                
                <div class="card" id="system-logs-card">
                    <div class="card-header">Logs du système</div>
                    
                    <div class="system-logs">
                        <div class="logs-container" id="system-logs">
                            Aucun log système disponible.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <script>
        // Éléments DOM
        const serverIndicator = document.getElementById('server-indicator');
        const serverStatusText = document.getElementById('server-status-text');
        const scrapingIndicator = document.getElementById('scraping-indicator');
        const scrapingStatusText = document.getElementById('scraping-status-text');
        const qdrantIndicator = document.getElementById('qdrant-indicator');
        const qdrantStatusText = document.getElementById('qdrant-status-text');
        const refreshButton = document.getElementById('refresh-status');
        const verifyServicesButton = document.getElementById('verify-services');
        const lastUpdateElement = document.getElementById('last-update');
        const refreshIndicator = document.getElementById('refresh-indicator');
        const qdrantStatsElement = document.getElementById('qdrant-stats');
        const scrapingLogsElement = document.getElementById('scraping-logs');
        const systemLogsElement = document.getElementById('system-logs');
        const githubLogsElement = document.getElementById('github-logs');
        
        // Boutons d'action
        const startScrapingButton = document.getElementById('start-scraping');
        const launchFaqScrapingButton = document.getElementById('launch-faq-scraping');
        const launchFullScrapingButton = document.getElementById('launch-full-scraping');
        const verifyConnectionButton = document.getElementById('verify-connection');
        const optimizeCollectionsButton = document.getElementById('optimize-collections');
        const githubUpdateButton = document.getElementById('github-update');
        
        // Checkboxes
        const forceFaqUpdateCheckbox = document.getElementById('force-faq-update');
        const forceFullUpdateCheckbox = document.getElementById('force-full-update');
        
        // Formater la date actuelle
        const dateParts = new Date().toISOString().split('T');
        const datePart = dateParts[0];
        const timePart = dateParts[1].substring(0, 8);
        lastUpdateElement.textContent = `${datePart} ${timePart}`;
        
        // URL de l'API
        const apiBaseUrl = window.location.origin;
        
        // Fonction pour mettre à jour le statut
        async function updateStatus() {
            try {
                refreshIndicator.textContent = "(rafraîchissement...)";
                
                const response = await fetch(`${apiBaseUrl}/admin/status`);
                const data = await response.json();
                
                // Mettre à jour l'indicateur du serveur
                if (data.server_status === 'ok') {
                    serverIndicator.className = 'status-indicator ok';
                    serverStatusText.textContent = data.server_message;
                } else {
                    serverIndicator.className = 'status-indicator error';
                    serverStatusText.textContent = data.server_message;
                }
                
                // Mettre à jour l'indicateur du scraping
                if (data.scraping_status === 'ready' || data.scraping_status === 'running') {
                    scrapingIndicator.className = 'status-indicator ok';
                    scrapingStatusText.textContent = data.scraping_message;
                } else {
                    scrapingIndicator.className = 'status-indicator error';
                    scrapingStatusText.textContent = data.scraping_message;
                }
                
                // Mettre à jour l'indicateur de Qdrant
                if (data.qdrant_status === 'connected') {
                    qdrantIndicator.className = 'status-indicator ok';
                    qdrantStatusText.textContent = data.qdrant_message;
                } else if (data.qdrant_status === 'warning') {
                    qdrantIndicator.className = 'status-indicator warning';
                    qdrantStatusText.textContent = data.qdrant_message;
                } else {
                    qdrantIndicator.className = 'status-indicator error';
                    qdrantStatusText.textContent = data.qdrant_message;
                }
                
                // Mettre à jour la date de dernière mise à jour
                const now = new Date();
                const formattedDate = `${now.toISOString().split('T')[0]} ${now.toTimeString().substring(0, 8)}`;
                lastUpdateElement.textContent = formattedDate;
                refreshIndicator.textContent = "(succès)";
                
            } catch (error) {
                console.error('Erreur lors de la mise à jour du statut:', error);
                serverIndicator.className = 'status-indicator error';
                serverStatusText.textContent = 'Erreur de connexion à l\'API';
                refreshIndicator.textContent = "(échec)";
            }
        }
        
        // Fonction pour vérifier les statistiques Qdrant
        async function checkQdrantStats() {
            try {
                const response = await fetch(`${apiBaseUrl}/qdrant-stats`);
                
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Mettre à jour l'élément des statistiques Qdrant
                qdrantStatsElement.classList.remove('error');
                qdrantStatsElement.innerHTML = `
                    <div>Collection BIOFORCE: ${data.faq_collection?.points_count || 0} points</div>
                    <div>Vecteurs: taille ${data.faq_collection?.vector_size || 1536}, distance ${data.faq_collection?.vector_distance || 'Cosine'}</div>
                `;
                
            } catch (error) {
                console.error('Erreur lors de la récupération des statistiques Qdrant:', error);
                qdrantStatsElement.classList.add('error');
                qdrantStatsElement.textContent = `Erreur: ${error.message}`;
            }
        }
        
        // Fonction pour lancer le scraping FAQ
        async function launchFaqScraping() {
            try {
                launchFaqScrapingButton.disabled = true;
                
                const forceUpdate = forceFaqUpdateCheckbox.checked;
                
                const response = await fetch(`${apiBaseUrl}/scrape/faq`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ force_update: forceUpdate })
                });
                
                const data = await response.json();
                
                // Mettre à jour les logs de scraping
                scrapingLogsElement.innerHTML += `\n[${new Date().toISOString()}] Scraping FAQ lancé: ${data.message}\n`;
                scrapingLogsElement.scrollTop = scrapingLogsElement.scrollHeight;
                
                // Mettre à jour le statut
                updateStatus();
                
            } catch (error) {
                console.error('Erreur lors du lancement du scraping FAQ:', error);
                scrapingLogsElement.innerHTML += `\n[${new Date().toISOString()}] Erreur: ${error.message}\n`;
                scrapingLogsElement.scrollTop = scrapingLogsElement.scrollHeight;
            } finally {
                launchFaqScrapingButton.disabled = false;
            }
        }
        
        // Fonction pour lancer le scraping complet
        async function launchFullScraping() {
            try {
                launchFullScrapingButton.disabled = true;
                
                const forceUpdate = forceFullUpdateCheckbox.checked;
                
                const response = await fetch(`${apiBaseUrl}/scrape/full`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ force_update: forceUpdate })
                });
                
                const data = await response.json();
                
                // Mettre à jour les logs de scraping
                scrapingLogsElement.innerHTML += `\n[${new Date().toISOString()}] Scraping complet lancé: ${data.message}\n`;
                scrapingLogsElement.scrollTop = scrapingLogsElement.scrollHeight;
                
                // Mettre à jour le statut
                updateStatus();
                
            } catch (error) {
                console.error('Erreur lors du lancement du scraping complet:', error);
                scrapingLogsElement.innerHTML += `\n[${new Date().toISOString()}] Erreur: ${error.message}\n`;
                scrapingLogsElement.scrollTop = scrapingLogsElement.scrollHeight;
            } finally {
                launchFullScrapingButton.disabled = false;
            }
        }
        
        // Événements
        refreshButton.addEventListener('click', () => {
            updateStatus();
            checkQdrantStats();
        });
        
        verifyServicesButton.addEventListener('click', () => {
            updateStatus();
        });
        
        launchFaqScrapingButton.addEventListener('click', launchFaqScraping);
        
        launchFullScrapingButton.addEventListener('click', launchFullScraping);
        
        startScrapingButton.addEventListener('click', () => {
            launchFaqScraping();
        });
        
        verifyConnectionButton.addEventListener('click', () => {
            updateStatus();
            checkQdrantStats();
        });
        
        // Navigation
        const navItems = document.querySelectorAll('.nav-item');
        for (const item of navItems) {
            item.addEventListener('click', function(e) {
                // Supprimer la classe active de tous les éléments
                for (const navItem of navItems) {
                    navItem.classList.remove('active');
                }
                
                // Ajouter la classe active à l'élément cliqué
                this.classList.add('active');
            });
        }
        
        // Initialisation
        updateStatus();
        checkQdrantStats();
        
        // Date actuelle pour l'affichage
        document.getElementById('date').textContent = new Date().toLocaleDateString();
    </script>
</body>
</html>